<div class="section-container">
  <div class="card user-card p-4">

    <div class="row mx-0 user-row user-container">
      <div class="col-lg-10 col-sm-8 col-8 d-flex align-items-center">
        <div class="fs25 fw600 color-dark-grey ">Push Notification
        </div>
      </div>
    </div>
    <!-- Filters  -->
    <div class="row  filter-row d-flex justify-content-center " [formGroup]="pushNotificationForm">
      <div class="col-lg-3 col-md-6 col-sm-12 "
        [ngClass]="{'pr-0': this.isScreenMobile() == false, 'px-2': this.isScreenMobile() == true}">
        <div class="w-100" style="margin-bottom: 9px;">
          <label class="fw500 mb-0 fs14 labels">Date From</label>
          <input type="text" class="form-control-date img cursor-pointer" (keydown)="restrictAlphas($event)"
            maxlength="10" formControlName="dateFrom" bsDatepicker placeholder="DD-MM-YYYY"
            style="background-image:url('/assets/img/common/calendar.png')" [maxDate]="today"
            [bsConfig]="{dateInputFormat: 'DD-MM-YYYY', showClearButton: true, clearPosition: 'right', showTodayButton: true, todayPosition: 'left',allowInput: false }"
            #dp="bsDatepicker" [bsValue]="bsValue">
        </div>
      </div>
      <div class="col-lg-3  col-md-6 col-sm-12 "
        [ngClass]="{'pr-0': this.isScreenMobile() == false, 'px-2': this.isScreenMobile() == true}">
        <div class="w-100" style="margin-bottom: 9px;">
          <label class="fw500 mb-0 fs14 labels">Date To</label>
          <input type="text" class="form-control-date img cursor-pointer" (keydown)="restrictAlphas($event)"
            maxlength="10" formControlName="dateTo" placeholder="DD-MM-YYYY" bsDatepicker
            style="background-image:url('/assets/img/common/calendar.png')" [maxDate]="today"
            [bsConfig]="{dateInputFormat: 'DD-MM-YYYY', showClearButton: true, clearPosition: 'right' , showTodayButton: true, todayPosition: 'left' }">
        </div>
      </div>
      <div class="col-lg-3  col-md-6 col-sm-12" *ngIf="this.showPushNotificationTypeFilter == true">
        <div class="mb-3">
          <label class="fw500 mb-0 fs14 labels">Channel</label>
          <select class="img input select-status" formControlName="topics" placeholder="Channel">
            <option value="" selected>Select</option>
            <option *ngFor="let type of this.notificationTopics" [attr.value]="type.key">
              {{ type.value }}</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Buttons -->
    <div class="row  d-flex justify-content-center mt-2 ">
      <div class="col-lg-2 col-md-4 col-sm-12 mb-3  inner-button-container ms-1">
        <button class="btn btn-prop cancle-btn fs15 fw500 btn-search  resetBtn" type="button" (click)="resetData()">
          Reset
        </button>
      </div>
      <div class="col-lg-2 col-md-4 col-sm-12 mb-3 inner-button-container">
        <button class="btn btn-prop bg-green fs15 fw500 search-btn btn-search " type="button" (click)="search(1)">
          Search
        </button>
      </div>
    </div>

    <!-- Separator -->
    <div class="separator fs18 fw500 my-3" [ngClass]="{'px-0': isScreenMobile() == true}">Search Results</div>

    <!-- Send notification button -->

    <div class="row  mb-4">
      <div class=" col-lg-2 col-md-4 text-left ">
        <button class="btn notification-button  p-2 color-blue fw500" (click)="pushNotificationModal()">
          <img src="assets/img/cms/plus.svg" class="add-icon me-1" width="15px">
          Send Notification
        </button>
      </div>
    </div>



    <!-- Card Table -->

    <div class="web-summary-card " *ngFor="let data of this.pushNotificationDetails; let i = index;">
      <div class="row summary-card p-0 mx-0 mb-3 d-flex flex-wrap col-12 position-relative">
        <div class="bg-light-blue br-10 detail-row mb-3 col-12">
          <div class="d-flex align-items-center ">
            <div class="col-1 ms-4">
              {{(this.currentPage-1)*10+i+1}}

            </div>

          </div>
        </div>

        <div class="d-flex flex-wrap px-3 w-100">
          <div class="col-2 pr-0 pb-3">
            <div class="fs14 color-grey fw500">Sent By</div>
            <div class="fw600 fs15">{{ data?.createdBy }}</div>
          </div>
          <div class="col-2 pr-0 pb-3">
            <div class="fs14 color-grey fw500">Date and Time</div>
            <div class="fw600 fs15">{{ data?.createdAt }}</div>
          </div>
          <div class="col-3 pr-0 pb-3">
            <div class="fs14 color-grey fw500">Channel</div>
            <div class="fw600 fs15">{{ data?.notificationValue }}</div>
          </div>
          <div class="col-2 pr-0 pb-3">
            <div class="fs14 color-grey fw500">Subject</div>
            <div class="fw600 fs15">{{ data?.title }}</div>
          </div>
          <div class="col-3 pr-0 pb-3">
            <div class="fs14 color-grey fw500">Body</div>
            <div class="fw600 fs15">{{ data?.body }}</div>
          </div>
          <div class="col-2 pr-0 pb-3">
            <div class="fs14 color-grey fw500">Status</div>
            <div class="fw600 fs15"
              [ngClass]="{'text-green': data?.status == 'SUCCESS','color-red': data?.status == 'FAILED'}">
              {{ data?.status }}
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- Pagination logics -->
    <div class="text-center d-flex justify-content-center mb-2" *ngIf="this.pushNotificationDetails.length > 0">
      <div class="pagination">
        <a href="javascript: void(0)" style="color: #333333;" (click)="goToPage(currentPage - 1)"><u>Prev</u></a>
        <a href="javascript: void(0)" *ngFor="let page of pageArray" (click)="goToPage(page)"
          [ngClass]="{'active': currentPage == page, 'no-page': page == 0}">
          {{page == 0 ? "..." : page}}
        </a>
        <a href="javascript: void(0)" style="color: #333333;" (click)="goToPage(currentPage + 1)"><u>Next</u></a>
      </div>
    </div>


  </div>
</div>

<!-- error modal  -->
<ng-template #responseModel let-modal>
  <div class="modal-body pb-4">
    <div class="row mx-0 text-left">
      <div class="col-sm-12 col-md-12 col-lg-12 px-0 text-left text-red" id="errorMessage">
        <img src="assets/img/common/cross.svg">
        {{this.errorMessage}}
      </div>
    </div>
  </div>
  <div class="w-100 text-center">
    <button class="btn btn-prop color-white bg-red w-50" type="button" data-dismiss="modal"
      (click)="close()">Close</button>
  </div>
</ng-template>




<!-- success modal  -->
<ng-template #successModal let-modal>
  <div class="modal-body pb-4  ">
    <div class="row mx-0 text-left ">
      <div class="col-sm-12 col-md-12 col-lg-12 px-0 mt-2 text-center text-green ">
        <img src="assets/img/common/tick.svg">
        {{ this.successMessage }}
      </div>
    </div>
  </div>
  <div class="w-100 text-center ">
    <button class="w-50 btn btn-prop bg-green" type="button" data-dismiss="modal" (click)="closeModal()">
      Close
    </button>
  </div>
</ng-template>


<!-- Notification modal  -->
<ng-template #sendNotificationModal let-modal>
  <div class="modal-body  m-0 p-0 " [ngClass]="{'pl-3 pr-0': this.isConfirmNotification === true}">
    <div class="modal-header row m-0 d-flex border-bottom-grey "
      [ngClass]="{'req-modal-margin': this.isConfirmNotification === true}" style="padding: 0px 0px !important;">
      <div class="col-10 ">
        <h5 class="modal-title  fs20 fw600  text-center ">
          Send Notification </h5>
      </div>
      <div class="col-2 text-end m-0 p-0  ">
        <img class="close  cursor-hand text-end " (click)="closeModal()"
          src="https://d1-slp-wp.supremelifeplatform.com/svl-ui/assets/img/BackOffice/Invoice/Cross.svg">
      </div>
    </div>

    <div class="row mx-0  text-left" [formGroup]="sendNotificationForm" *ngIf="this.isConfirmNotification == false">

      <div class="col-sm-12 col-md-12 col-lg-12 px-0 color-blue mb-1 text-start ">
        <label class="color-blue fw500 mb-0 mt-4 modal-heading fs15 text-start ">Subject<span
            class="asterisk">*</span></label>
        <input type="text" (keydown)="spaceRestrict($event)" class="form-control" autocomplete="off"
          formControlName="subject" maxlength="30" [ngClass]="{'redBorder': this.sendNotificationForm.get('subject').invalid &&
        (this.sendNotificationForm.get('subject').dirty || this.sendNotificationForm.get('subject').touched) ||
        ( this.submitted && this.sendNotificationForm.get('subject').   invalid )}">
        <div class="colour-red invalidtext fs12" *ngIf="this.sendNotificationForm.get('subject').invalid &&
        (this.sendNotificationForm.get('subject').dirty || this.sendNotificationForm.get('subject').touched) ||
        ( this.submitted && this.sendNotificationForm.get('subject').invalid )">Subject is required
        </div>
        <div class="error-info-icon">
          <span class="fa fa-info-circle  mr-1  mb-4"></span> Maximum 30 characters allowed
        </div>

      </div>
      <div class="col-sm-12 col-md-12 col-lg-12 px-0 color-blue mb-1 text-start "
        *ngIf="this.showPushNotificationTypeFilter == true">
        <div class="mb-3">
          <label class="color-blue fw500 mb-0 modal-heading fs15 text-start ">Channel</label>
          <select class="img input select-status" formControlName="topics" placeholder="Channel">
            <option value="" selected>Select</option>
            <option *ngFor="let type of this.notificationTopics" [attr.value]="type.key">
              {{ type.value }}</option>
          </select>
        </div>
      </div>
      <div class="col-sm-12 col-md-12 col-lg-12 px-0 color-blue   text-start ">
        <label class="color-blue fw500 mb-0 modal-heading fs15">Body<span class="asterisk">*</span></label>
        <textarea (keydown)="spaceRestrict($event)" formControlName="body" rows="4" class="req-comment" maxlength="100"
          cols="50" placeholder="Add Body" [ngClass]="{'redBorder': this.sendNotificationForm.get('body').invalid &&
          (this.sendNotificationForm.get('body').dirty || this.sendNotificationForm.get('body').touched) ||
          ( this.submitted && this.sendNotificationForm.get('body').invalid )}"></textarea>
        <div class="colour-red invalidtext fs12 mt-n2" *ngIf="this.sendNotificationForm.get('body').invalid &&
        (this.sendNotificationForm.get('body').dirty || this.sendNotificationForm.get('body').touched) ||   
        ( this.submitted && this.sendNotificationForm.get('body').invalid )">Body is required
        </div>
        <div class="error-info-icon mt-n1">
          <span class="fa fa-info-circle  mr-1 mb-4"></span> Maximum 100 characters allowed
        </div>
      </div>

    </div>
    <div class="confim-model " [formGroup]="sendNotificationForm" *ngIf="this.isConfirmNotification == true">
      <div class="row mx-0 my-2 text-left">

        <div class="col-12 px-0 text-start mb-2 mt-2">
          <label class="color-blue modal-heading fw600 mb-0 fs16">Subject</label>
          <div class="confirm-detail fs15 color-grey">
            {{this.sendNotificationForm.controls.subject.value}}

          </div>
        </div>
        <div class="col-12 px-0 text-start mb-2 mt-2" *ngIf="this.showPushNotificationTypeFilter == true">
          <label class="color-blue modal-heading fw600 mb-0 fs16">Channel</label>
          <div class="confirm-detail fs15 color-grey">
            {{ getNotificationTopicValue() }}
          </div>
        </div>
        <div class="col-12 px-0 text-start mt-2  mb-2 ">
          <label class="color-blue modal-heading fw600 mb-0 fs16">Body</label>
          <div class="confirm-detail fs15 color-grey  ">
            {{this.sendNotificationForm.controls.body.value}}

          </div>
        </div>
      </div>

    </div>
  </div>
  <div class="  popup-border text-center mt-2">
    <button class="btn btn-prop modalbutton col-2 modalcancleButton  " type="button" data-dismiss="modal"
      (click)="closeModal()">
      Cancel
    </button>
    <button class="btn btn-prop modalbutton col-2 modalconfirmButton  " type="button" data-save="modal"
      (click)="this.isConfirmNotification == false ? confirmSendNotification() : sendNotification()">
      {{this.isConfirmNotification == false ? 'Confirm' : 'Send'}}

    </button>
  </div>
</ng-template>