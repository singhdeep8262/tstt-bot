<div class="section-container">
  <div class="card user-card p-0">
    <div class="row mx-0 user-row user-container">
      <div class="col-lg-10 col-sm-8 col-5 d-flex align-items-center">
        <div class="fs25 fw600 color-dark-grey ml-2">Roles
        </div>
      </div>
      <div class="col-lg-2 col-sm-4 col-7" *ngIf="this.createRoleAccess">
        <button class="btn btn-prop add-user-btn fs15 fw500" type="button" (click)="gotoAddRole()">
          <img src="assets/img/common/add.png" class="mr-2 add-img">
          Add Role
        </button>
      </div>
    </div>
    <div class="row mx-0 user-row" [formGroup]="rolesForm">
      <div class="col-lg-2 col-sm-6">
        <div class="mb-3">
          <label class="fw500 mb-0 fs14 labels">Role Name</label>
          <input type="text" class="form-control input5" formControlName="roleName" placeholder="Role Name"
          oninput="this.value=this.value.replace(/[^[a-zA-Z ]*$]/g,'');" (keypress)="letterOnly($event)"  (keydown)="spaceRestrict($event)">
        </div>
      </div>
      <div class="col-lg-2 col-sm-6">
        <div class="mb-3">
          <label class="fw500 mb-0 fs14 labels">Role Key</label>
          <input type="text" class="form-control input5" formControlName="roleKey" placeholder="Role Key"
            (keydown)="spaceRestrict($event)">
        </div>
      </div>
      <div class="col-lg-2 col-sm-12 button-search">
        <div class="mb-3">
          <button class="btn btn-prop bg-green fs15 fw500 search-btn" type="button" (click)="getRoles(1)">
            Search
          </button>
        </div>
      </div>
      <div class="col-lg-6 d-flex justify-content-end text-right mb-3 col-sm-12 button-search" *ngIf="this.editHeirarchy">
        <div class="col-lg-4">
          <button class="btn btn-prop bg-blue fs15 fw500 search-btn" type="button" (click)="editHierarchy()">
            <img src="assets/img/common/Edit.svg" class="mr-2 add-img">
            Edit Hierarchy
          </button>
        </div>
      </div>
    </div>

    <table class="table mb-5 user-table1">
      <thead>
        <tr class="rowAlign text-center  fs15 fw500">
          <th style="width: 5%;">S. No.</th>
          <th>Role Name</th>
          <th>Role Key</th>
          <th>Total Users</th>
          <th width="8%" *ngIf="this.editRoleAccess"></th>
          <th width="10%" *ngIf="this.deleteRoleAccess"></th>
        </tr>
      </thead>
      <tbody class="fs15 fw500">
        <tr class="trBody text-center cursor-hand" *ngFor="let td of this.rolesList;let i=index">
          <td>{{(this.currentPage-1)*10+i+1}}</td>
          <td>{{td?.name}}</td>
          <td>{{td?.key}}</td>
          <td>{{td?.totalUsers}}</td>
          <td *ngIf="this.editRoleAccess" class="color-blue pointer" (click)="editRole(td.id)"><img
              src="assets/img/common/Edit.svg" class="ms-2 update-icon">Edit</td>
          <td *ngIf="this.deleteRoleAccess" class="color-red pointer" (click)="deleteRole(td?.id)"><img
              src="assets/img/common/Delete.svg" class="ms-2 update-icon">Delete</td>
        </tr>
        <tr *ngIf="this.rolesList.length == 0">
          <td class="text-center" colspan="12">No Data Found</td>
        </tr>
      </tbody>

    </table>
    <div class="text-center d-flex justify-content-center mb-2" *ngIf="this.rolesList.length > 0">
      <div class="pagination">
        <a href="javascript: void(0)" style="color: #333333;" (click)="goToPage(currentPage - 1)"><u>Prev</u></a>
        <a href="javascript: void(0)" *ngFor="let page of pageArray" (click)="goToPage(page)"
          [ngClass]="{'active': currentPage == page, 'no-page': page == 0}">
          {{page == 0 ? "..." : page}}
        </a>
        <a href="javascript: void(0)" style="color: #333333;" (click)="goToPage(currentPage + 1)"><u>Next</u></a>
      </div>
    </div>

  </div>
</div>

<div class="hierarchyModal" [ngClass]="{'d-none': showHideHeirarchy}">
  <div class="editHierarchy">
    <div class="editHierarchyTitle text-center mb-1 fw-600 "> EDIT HIERARCHY </div>
    <div class="roleHeader d-flex justify-content-center align-items-center">
      <div class="w-50 text-center fw500 fs15  ">Role Name</div>
      <div class="w-50 text-center fw500  fs15 ">Role Key</div>
    </div>
    <div cdkDropList class="example-list" (cdkDropListDropped)="drop($event)">
      <div class="example-box d-flex" *ngFor="let item of this.editHierarchyList" cdkDrag>
        <div class="w-50 text-center"> {{item.name}}</div>
        <div class="w-50 text-center">{{item.key}}</div>
      </div>
    </div>
    <div class="text-center pt-4 row justify-content-center">
      <button class="btn btn-prop bg-green button-cancel fs15 fw500 cancel-btn" type="button" data-dismiss="modal"
        (click)="cancelHeirarchy()">Cancel </button>
      <button class="btn btn-prop color-white bg-green delete-button" type="button" data-dismiss="modal"
        (click)="editData(this.editHierarchyList)">Confirm </button>
    </div>
  </div>
</div>

<ng-template #responseModel let-modal>
  <div class="modal-body pb-4">
    <div class="row mx-0 text-left">
      <div class="col-sm-12 col-md-12 col-lg-12 px-0 text-left text" id="errorMessage">
        <img src="assets/img/common/cross.svg">
        {{this.errorMessage}}
      </div>
    </div>
  </div>
  <div class="w-100 text-center">
    <button class="btn btn-prop color-white bg-red w-50" type="button" data-dismiss="modal"
      (click)="closeModal()">Close</button>
  </div>
</ng-template>


<ng-template #deleteModel let-modal>
  <div class="modal-body pb-4">
    <div class="row mx-0 text-left">
      <div class="col-sm-12 col-md-12 col-lg-12 px-0 text-left text" id="errorMessage">
        {{this.deleteMessage}}
      </div>
    </div>
  </div>
  <div class="w-100 text-center row">
    <button class="btn btn-prop bg-green button-cancel fs15 fw500 cancel-btn" type="button" data-dismiss="modal"
      (click)="closeModal()">Cancel </button>
    <button class="btn btn-prop color-white bg-red delete-button" type="button" data-dismiss="modal"
      (click)="confirmDelete()">Delete </button>
  </div>
</ng-template>

<ng-template #successModel let-modal>
  <div class="modal-body pb-4">
    <div class="row mx-0 text-left">
      <div class="col-sm-12 col-md-12 col-lg-12 px-0 text-left text" id="errorMessage">
        <img src="assets/img/common/tick.svg">
        {{this.successMessage}}
      </div>
    </div>
  </div>
  <div class="w-100 text-center">
    <button class="btn btn-prop close-button color-white bg-green w-50" type="button" data-dismiss="modal"
      (click)="closeModal()">Close</button>
  </div>
</ng-template>

<ng-template #confirmHeirarchyModel let-modal>
  <div class="modal-header">
    <h5 class="modal-title">Are you sure you want to continue?</h5>
  </div>
  <div class="modal-body pb-4 pt-0">
    <div class="row mx-0 text-left">
      <table class="table mb-5 user-table">
        <thead>
          <tr class="rowAlign  fs15 fw500">
            <th>Role Name</th>
            <th>Role Key</th>
          </tr>
        </thead>
        <tbody class="fs15 fw500">
          <tr class="trBody  cursor-hand " *ngFor="let item of this.newHeirarchyName">
            <td>{{item.name}}</td>
            <td>{{item.key}}</td>
        </tbody>
      </table>
    </div>
  </div>
  <div class="w-100 text-center row justify-content-center">
    <button class="btn btn-prop bg-green button-cancel fs15 fw500 cancel-btn" type="button" data-dismiss="modal"
      (click)="cancelHeirarchy()">Close </button>
    <button class="btn btn-prop color-white bg-green delete-button" type="button" data-dismiss="modal"
      (click)="this.confirmHeirarchy()">Confirm </button>
  </div>
</ng-template>


<ng-template #updateModel let-modal>
  <div class="modal-body pb-4">
    <div class="row mx-0 text-left">
      <div class="col-sm-12 col-md-12 col-lg-12 px-0 text-left text" id="errorMessage">
        Are you sure you want to update the details?
      </div>
    </div>
  </div>
  <div class="w-100 text-center row">
    <button class="btn btn-prop fs15 fw500 cancel-button button-cancel" type="button" data-dismiss="modal"
      (click)="closeModal()">Cancel </button>
    <button class="btn btn-prop color-white bg-green delete-button close-button" type="button" data-dismiss="modal"
      (click)="moduleUpdation()">Save </button>
  </div>
</ng-template>